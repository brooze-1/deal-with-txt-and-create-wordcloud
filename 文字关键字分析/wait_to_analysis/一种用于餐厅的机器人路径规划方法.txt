








备注：发明
名称：一种用于餐厅的机器人路径规划方法
申请人：华东交通大学
发明人：聂学方（360423198001110813）、范茗艺、简豪欣、周天清、廖龙霞、赵军辉
联系人：聂学方




本申请涉及一种用于餐厅的机器人路径规划方法，它包括如下步骤：实时定位机器人相对位置，记录餐厅内物体摆放位置及图像信息；机器人接收网络CSI信息，记录物体位置周围和空旷位置参考点的CSI信号强度；构建室内地图，同时存储物体位置与各参考点处CSI信号强度信息；利用KNN算法并融合WiFi定位及机器人ROS系统定位，获得准确位置；利用深度摄像头获取目标图像，提取图像特征，计算目标距离信息；结合A*算法与DWA算法计算出机器人前往目标地最佳路径；当机器人偏离最佳路径时，则重新规划路线。本发明可自动规划餐厅机器人的移动路线，获得最佳移动路径，缩短移动距离，提高移动效率，节约能源消耗。






1.一种用于餐厅的机器人路径规划方法，其特征在于，包括如下步骤：
S1：机器人在新餐厅环境内全方位走动，利用电机转速及IMU数据实时定位机器人相对位置，通过深度摄像头、激光雷达记录餐厅内物体摆放位置及图像信息；
S2：在餐厅内固定位置安装WiFi无线接入点，机器人接收网络CSI信息，记录餐厅内物体位置周围接收的CSI信号强度，以及空旷位置N个参考点的CSI信号强度；
S3：通过Gmapping构建室内地图，同时存储物体位置与各参考点处CSI信号强度信息；
S4：利用KNN算法，即K最近邻算法，融合WiFi定位及机器人ROS系统定位，结合卡尔曼滤波获得准确位置；
S5：机器人在移动过程中，利用深度摄像头获取目标图像，使用TensorFlow提取图像特征；利用三角定位法计算目标距离信息；
S6：结合全局路径规划A*算法与局部路径规划DWA算法计算出机器人前往目标地最佳路径；当ROS监测到机器人偏离最佳路径时，则重新规划路线。
2.根据权利要求1所述的一种用于餐厅的机器人路径规划方法，其特征在于，所述步骤S2中机器人通过WiFi通信模块与所述服务器进行通信，获得网络CSI信息；
所述步骤S2包括2 个阶段：训练阶段和测试阶段；在训练阶段，将收集到的每个参考点位置处的 WiFi 信号强度和这些参考点对应的位置坐标存储到机器人的存储器中；每个参考点处采集多组接收信号强度数据；对于第  个参考点，所述第  个参考点的位置坐标处对应的位置数据矢量可以表示为，其中，P为WiFi无线接入点的数量，是位置  处的第个接收信号强度；在测试阶段，利用待定位点处采集到的数据，通过信号强度配合当前机器人和周边物体的距离，实现位置的推算。
3.根据权利要求1所述的一种用于餐厅的机器人路径规划方法，其特征在于，所述步骤S4的具体方法为：
S401：计算机器人与行进过程中的每一个障碍物之间的距离，所述障碍物包括静态障碍物与动态障碍物，每个障碍物都视为一个样本点；将计算得到的距离值从小到大进行排序，选出距离机器人最近的K个样本点；
S402：将所述样本点用矩阵表示，计算两个样本点之间的欧氏距离或者相似度，选出最近的样本点；
S403：基于KNN算法计算当前测试点  的位置数据与数据库中每个参考点数据之间的距离：

其中，是测试位置处的第个位置特征；是可用位置特征的数量；
S404；选择距离最小的个位置作为该位置的最近邻位置数据；通过取所有个最近邻位置的平均值来确定用户的位置；
S405：通过深度摄像头识别出不同的行人和机器人之间的距离，通过积累数据实现对行人的轨迹进行预测，并作为机器人路径规划的依据。
4.根据权利要求1所述的一种用于餐厅的机器人路径规划方法，其特征在于，所述步骤S5中，机器人通过一束激光以一定的入射角度照射机器人周围物体，即障碍物，激光在障碍物表面发生反射和散射；机器人在另一角度利用透镜对反射激光汇聚成像，光斑成像在CCD位置传感器上；当障碍物沿激光方向发生移动时，CCD位置传感器上的光斑将产生移动，所述光斑的位移大小对应被测障碍物的移动距离。
5.根据权利要求1所述的一种用于餐厅的机器人路径规划方法，其特征在于，所述步骤S6中，所述A*算法的具体步骤为：生成空的open表和close表，将机器人当前所在的位置数据放入open表中，将open表中的节点按照估价函数进行排序，得到代价函数最小值的节点U；将所述节点U从open表中移除，放入close表中，判断所述节点U是否是目标地点；如果所述节点U是目标地，则回溯close表得到机器人的路径，如果不是，将节点U所有的邻节点按照邻节点的规则加入open表，并重复上述步骤。
6.根据权利要求1所述的一种用于餐厅的机器人路径规划方法，其特征在于，所述步骤S6中，所述DWA算法的具体步骤为：将步骤S1、S2获得的数据作为感知数据，步骤S3、S4和S5获得的数据作为定位数据和footprint数据；对感知数据和定位数据同步或融合后进行解析，创建代价地图costmap；对footprint数据进行解析后，将代价地图costmap和经过解析的感知数据、定位数据进行速度采样，生成轨迹空间并进行评价，判断是否撞到障碍物；如果没有撞到障碍物，则选取所述轨迹空间为最优轨迹，如果撞到障碍物，则重新进行轨迹评价并判断是否撞到障碍物；选取到最优轨迹后，判断轨迹空间是否完成遍历，如没有遍历则重新进行轨迹评价。
7.根据权利要求1所述的一种用于餐厅的机器人路径规划方法，其特征在于，所述机器人获取的信息包括人流信息、周边环境的深度信息、机器人相对于地图的坐标变换信息、更新障碍的信息、深度图和餐厅机器人自身的状态信息。

一种用于餐厅的机器人路径规划方法
技术领域
本申请涉及室内导航技术领域，具体涉及一种用于餐厅的机器人路径规划方法。
背景技术
机器人属于移动机器人的一种，现代社会对移动机器人的需求不断提高，如何使机器人更加自主化是一个很重要的问题。餐厅人流量多，人群动态行动，环境更复杂，现有餐厅机器人的路径规划上，无法快速排除人群移动对机器人路径规划的影响，降低了机器人的送餐效率。
发明内容
本发明的目的在于，提供一种用于餐厅的机器人路径规划方法，在进行路径规划时加入人流状态参数，对机器人进行动态路径规划，为机器人提供的最优送餐路径，缩短移动距离，提高移动效率，节约能源消耗。
本发明采取的技术方案是：一种用于餐厅的机器人路径规划方法，包括如下步骤：
S1：机器人在新餐厅环境内全方位走动，利用电机转速及IMU数据实时定位机器人相对位置，通过深度摄像头、激光雷达记录餐厅内物体摆放位置及图像信息；
S2：在餐厅内固定位置安装WiFi无线接入点，机器人接收网络CSI信息，记录餐厅内物体位置周围接收的CSI信号强度，以及空旷位置N个参考点的CSI信号强度；
S3：通过Gmapping构建室内地图，同时存储物体位置与各参考点处CSI信号强度信息；
S4：利用KNN算法，即K最近邻算法，融合WiFi定位及机器人ROS系统定位，结合卡尔曼滤波获得准确位置；
S5：机器人在移动过程中，利用深度摄像头获取目标图像，使用TensorFlow提取图像特征；利用三角定位法计算目标距离信息；
S6：结合全局路径规划A*算法与局部路径规划DWA算法计算出机器人前往目标地最佳路径；当ROS监测到机器人偏离最佳路径时，则重新规划路线。
进一步地，所述步骤S2中机器人通过WiFi通信模块与所述服务器进行通信，获得网络CSI信息；
所述步骤S2包括2 个阶段：训练阶段和测试阶段；在训练阶段，将收集到的每个参考点位置处的 WiFi 信号强度和这些参考点对应的位置坐标存储到机器人的存储器中；每个参考点处采集多组接收信号强度数据；对于第  个参考点，所述第  个参考点的位置坐标处对应的位置数据矢量可以表示为，其中，P为WiFi无线接入点的数量，是位置  处的第个接收信号强度；在测试阶段，利用待定位点处采集到的数据，通过信号强度配合当前机器人和周边物体的距离，实现位置的推算。
进一步地，所述步骤S4的具体方法为：
S401：计算机器人与行进过程中的每一个障碍物之间的距离，所述障碍物包括静态障碍物与动态障碍物，每个障碍物都视为一个样本点；将计算得到的距离值从小到大进行排序，选出距离机器人最近的K个样本点；
S402：将所述样本点用矩阵表示，计算两个样本点之间的欧氏距离或者相似度，选出最近的样本点；
S403：基于KNN算法计算当前测试点  的位置数据与数据库中每个参考点数据之间的距离：

其中，是测试位置处的第个位置特征；是可用位置特征的数量；
S404；选择距离最小的个位置作为该位置的最近邻位置数据；通过取所有个最近邻位置的平均值来确定用户的位置；
S405：通过深度摄像头识别出不同的行人和机器人之间的距离，通过积累数据实现对行人的轨迹进行预测，并作为机器人路径规划的依据。
进一步地，所述步骤S5中，机器人通过一束激光以一定的入射角度照射机器人周围物体，即障碍物，激光在障碍物表面发生反射和散射；机器人在另一角度利用透镜对反射激光汇聚成像，光斑成像在CCD位置传感器上；当障碍物沿激光方向发生移动时，CCD位置传感器上的光斑将产生移动，所述光斑的位移大小对应被测障碍物的移动距离。
进一步地，所述步骤S6中，所述A*算法的具体步骤为：生成空的open表和close表，将机器人当前所在的位置数据放入open表中，将open表中的节点按照估价函数进行排序，得到代价函数最小值的节点U；将所述节点U从open表中移除，放入close表中，判断所述节点U是否是目标地点；如果所述节点U是目标地，则回溯close表得到机器人的路径，如果不是，将节点U所有的邻节点按照邻节点的规则加入open表，并重复上述步骤。
进一步地，所述步骤S6中，所述DWA算法的具体步骤为：将步骤S1、S2获得的数据作为感知数据，步骤S3、S4和S5获得的数据作为定位数据和footprint数据；对感知数据和定位数据同步或融合后进行解析，创建代价地图costmap；对footprint数据进行解析后，将代价地图costmap和经过解析的感知数据、定位数据进行速度采样，生成轨迹空间并进行评价，判断是否撞到障碍物；如果没有撞到障碍物，则选取所述轨迹空间为最优轨迹，如果撞到障碍物，则重新进行轨迹评价并判断是否撞到障碍物；选取到最优轨迹后，判断轨迹空间是否完成遍历，如没有遍历则重新进行轨迹评价。
进一步地，所述机器人获取的信息包括人流信息、周边环境的深度信息、机器人相对于地图的坐标变换信息、更新障碍的信息、深度图和餐厅机器人自身的状态信息。
本发明的有益效果在于：使用KNN算法确定机器人所在位置及障碍物的分布时，将行人的速度和朝向也作为状态指标的输入，完整的统计机器人在送餐过程中可能遇到的所有障碍物，降低行人对机器人路径规划的影响；融合WiFi无线网络定位和机器人ROS系统定位，准确判断机器人自身的位置信息；通过DWA算法和A*算法计算出机器人前往目标地点最佳路径，并在机器人偏离路径是重新进行路径规划，降低机器人在顾客较多的餐厅中任务代价；将A*算法与DWA算法结合，避免单独使用DWA算法只能获得局部最优解，有效缩短机器人的移动距离，提高移动效率，节约能源消耗。
附图说明
为了更清楚地说明本发明实施例中的技术方案，下面将对实施例中所需要使用的附图作简单地介绍，显而易见地，下面描述中的附图仅仅是本申请的一些实施例，对于本领域普通技术人员来讲，在不付出创造性劳动的前提下，还可以根据这些附图获得其它的附图。
图1为本发明实施例的流程图；
图2为本发明实施例中Gmapping 软件框图；
图3为本发明实施例获得的二维度的占用栅格地图；
图4为本发明实施例中蒙特卡洛粒子定位示意图；
图5为本发明实施例中A*算法流程图；
图6为本发明实施例中DWA算法流程图；
图7为本发明实施例中路径规划算法仿真结果示意图。
具体实施方式
为了能够更清楚地理解本发明的上述目的、特征和优点，下面结合附图和具体实施方式对本发明进行进一步的详细描述。在下面的描述中阐述了很多具体细节以便于充分理解本发明，但是，本发明还可以采用其他不同于在此描述的其他方式来实施，因此，本发明并不限于下面公开的具体实施例的限制。
除非另作定义，此处使用的技术术语或者科学术语应当为本申请所述领域内具有一般技能的人士所理解的通常意义。本专利申请说明书以及权利要求书中使用的“第一”、“第二”以及类似的词语并不表示任何顺序、数量或者重要性，而只是用来区分不同的组成部分。同样， “一个”或者“一”等类似词语也不表示数量限制，而是表示存在至少一个。 “连接”或者“相连”等类似的词语并非限定于物理的或者机械的连接，而是可以包括电性的连接，不管是直接的还是间接的。 “上”、 “下”、 “左”、 “右”等仅用于表示相对位置关系，当被描述对象的绝对位置改变后，则该相对位置关系也相应地改变。
如图1~图7所示，一种用于餐厅的机器人路径规划方法，包括如下步骤：
S1：机器人在新餐厅环境内全方位走动，利用电机转速及IMU数据实时定位机器人相对位置，通过深度摄像头、激光雷达记录餐厅内物体摆放位置及图像信息；本发明实施例采用英特尔公司的实感 D435i的深度摄像头，机器人通过深度摄像头获取障碍物的深度信息，深度信息数据包含一个二维矩阵，矩阵的尺度取决于深度相机的分辨率，矩阵每个元素是对应像素的深度值。
深度摄像头和激光雷达通过USB直接与嵌入式Linux开发板JetsonNano连接，激光雷达用来构建环境的地图以及在建立地图完成后的导航任务中定位机器人，深度摄像头用在构建地图过程中修正激光雷达建立的地图并结合激光雷达获取周围物体位置及图像信息。
在步骤S1中，本发明实施例加入了餐厅中行人的状态，包括行人的速度和行人的朝向，在进行路径规划时考虑到行人的活动状态对机器人送餐的影响，使得机器人在送餐过程中能够高效的躲避行人，降低机器人在顾客较多的餐厅中送餐时的任务代价。
S2：在餐厅内固定位置安装WiFi无线接入点，机器人接收网络CSI信息，记录餐厅内物体位置周围接收的CSI信号强度，以及空旷位置N个参考点的CSI信号强度； 
所述步骤S2中机器人通过WiFi通信模块与所述服务器进行通信，获得网络CSI信息；
所述步骤S2包括2 个阶段：训练阶段和测试阶段；采样区域包括P个WiFi无线接入点和N个参考点；在训练阶段，将收集到的每个参考点位置处的 WiFi 信号强度和这些参考点对应的位置坐标存储到机器人的存储器中；每个参考点处采集多组接收信号强度数据；对于第  个参考点，所述第  个参考点的位置坐标处对应的位置数据矢量可以表示为，其中，P为WiFi无线接入点的数量，是位置  处的第个接收信号强度；在测试阶段，利用待定位点处采集到的数据，通过信号强度配合当前机器人和周边物体的距离，实现位置的推算。
S3：通过Gmapping构建室内地图，构建室内地图时，需要输入的信息包括所述深度摄像头获取的图像信息、所述激光雷达的获得数据、所述电机转动测量单元和惯性测量单元获取的信息。通过机器人底盘电机转速信息及惯性测量单元IMU数据实时定位机器人位置，Gmapping算法的输入为激光雷达的数据/scan以及机器人里程计和激光雷达之间坐标变化的/tf信息，其中，机器人采用SLAM程序的定位和导航功能模块；输出为机器人里程计和地图之间坐标变化的/tf信息、机器人位姿估计的分散程度/slam_gmapping/entropy、建立的地图数据/map和地图的相关信息/map_metadata。在通过Gmapping算法构建室内地图时，机器人还存储了物体位置与各参考点处CSI信号强度信息。
在控制机器人构建完成整个环境的地图之后，可得到如图3所示的二维度的占用栅格地图，地图中白色区域为可通行区域，灰色区域是位置区域，黑色区域表示为障碍物所在区域，黑色越深，表示该区域有障碍物的概率越大。 
S4：利用KNN算法，即K最近邻算法，融合WiFi定位及机器人ROS系统定位，结合卡尔曼滤波获得准确位置；
具体来说，假如估测的机器人位置信息为[x,y,θ]，其中x和y分别表示横坐标和纵坐标，θ表示机器人朝向，记录机器人的位置信息符合μ=[x,y,θ]的多元高斯分布。通过高斯分布采样出M个粒子表示机器人可能的位置，并描述机器人位置信息的噪音，采用蒙特卡洛算法确定机器人在所述步骤S3中构建出的室内地图上的位置和姿态。图4（a）所述为单元高斯模型的采样情况和对应的高斯分布模型，图4（b）为二元高斯模型采样的情况。
所述步骤S4的具体方法为：
S401：计算机器人与行进过程中的每一个障碍物之间的距离，所述障碍物包括静态障碍物与动态障碍物，每个障碍物都视为一个样本点；将计算得到的距离值从小到大进行排序，选出距离机器人最近的K个样本点；
S402：将所述样本点用矩阵表示，计算两个样本点之间的欧氏距离或者相似度，选出最近的样本点；
S403：基于KNN算法计算当前测试点  的位置数据与数据库中每个参考点数据之间的距离：

其中，是测试位置处的第个位置特征；是可用位置特征的数量；
S404；选择距离最小的个位置作为该位置的最近邻位置数据；通过取所有个最近邻位置的平均值来确定用户的位置；
S405：通过深度摄像头识别出不同的行人和机器人之间的距离，通过积累数据实现对行人的轨迹进行预测，并作为机器人路径规划的依据。
S5：机器人在移动过程中，利用深度摄像头获取目标图像，使用TensorFlow提取图像特征；利用三角定位法计算目标距离信息；具体为机器人通过一束激光以一定的入射角度照射机器人周围物体，即障碍物，激光在障碍物表面发生反射和散射；机器人在另一角度利用透镜对反射激光汇聚成像，光斑成像在CCD位置传感器上；当障碍物沿激光方向发生移动时，CCD位置传感器上的光斑将产生移动，所述光斑的位移大小对应被测障碍物的移动距离。
S6：结合全局路径规划A*算法与局部路径规划DWA算法计算出机器人前往目标地最佳路径；当ROS监测到机器人偏离最佳路径时，则重新规划路线。
所述A*算法的具体步骤为：生成空的open表和close表，将机器人当前所在的位置数据作为起点S放入open表中，将open表中的节点按照估价函数进行排序，得到代价函数最小值的节点U；将所述节点U从open表中移除，放入close表中，判断所述节点U是否是目标地点；如果所述节点U是目标地，则回溯close表得到机器人的路径，如果不是，将节点U所有的邻节点按照邻节点的规则加入open表，并重复上述步骤。
所述DWA算法的具体步骤为：将步骤S1、S2获得的数据作为感知数据，步骤S3、S4和S5获得的数据作为定位数据和footprint数据；对感知数据和定位数据同步或融合后进行解析，创建代价地图costmap；对footprint数据进行解析后，将代价地图costmap和经过解析的感知数据、定位数据进行速度采样，生成轨迹空间并进行评价，判断是否撞到障碍物；如果没有撞到障碍物，则选取所述轨迹空间为最优轨迹，如果撞到障碍物，则重新进行轨迹评价并判断是否撞到障碍物；选取到最优轨迹后，判断轨迹空间是否完成遍历，如没有遍历则重新进行轨迹评价。
在本发明实施例中，所述机器人获取的信息包括人流信息、周边环境的深度信息、机器人相对于地图的坐标变换信息、更新障碍的信息、深度图和餐厅机器人自身的状态信息；机器人自身的状态信息则包括里程计信息、速度控制信息、电机温度、转子位置和转速等信息、电机的编码器信息。本发明实施例使用KNN算法确定机器人所在位置及障碍物的分布时，将行人的速度和朝向也作为状态指标的输入，完整的统计机器人在送餐过程中可能遇到的所有障碍物，降低行人对机器人路径规划的影响；融合WiFi无线网络定位和机器人ROS系统定位，准确判断机器人自身的位置信息；通过DWA算法和A*算法计算出机器人前往目标地点最佳路径，并在机器人偏离路径是重新进行路径规划，降低机器人在顾客较多的餐厅中任务代价。将A*算法与DWA算法结合，避免单独使用DWA算法只能获得局部最优解，有效缩短机器人的移动距离，提高移动效率，节约能源消耗。
以上所述仅为本发明的优选实施例而已，并不用于限制本发明，对于本领域的技术人员来说，本发明可以有各种更改和变化。凡在本发明的精神和原则之内，所作的任何修改、等同替换、改进等，均应包含在本发明的保护范围之内。


图1

图2

图3

图4

图5

图6

图7

